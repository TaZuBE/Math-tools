import{c as $}from"./computeExpr-D_yysp4G.js";import{f as M,_ as g,o as y,c as a,b as i,j as K,v as E,n as r,t as d,k as v,e as k,w as h,T as f,F as m,g as c,p as S,a as w}from"./index-D8z2FZUJ.js";const b=M({name:"Calculator",data(){return{expr:"",cursorSymbol:Symbol(),input:{},previousExpr:[{expr:"",cursor:0}],exprIndex:0,resultScale:1,showMemory:!1,memories:[],history:[],on:[],choices:[{options:["DEG","RAD"],selected:"DEG",selectedIndex:0}]}},computed:{result(){return $(this.expr)},cursorPosition:{get(){return this.$nextTick(()=>{this.cursorSymbol=Symbol()}),this.cursorSymbol,this.input.selectionStart},set(s){this.input.selectionStart=s,this.input.selectionEnd=s}}},mounted(){new ResizeObserver(this.changeResultSize).observe(this.$refs.output),this.on[2]=!0,this.$nextTick(()=>{this.input=this.$refs.expr})},watch:{expr(s,e){this.$nextTick(this.changeResultSize)}},methods:{setCursor(s){this.$nextTick(()=>{this.input.selectionStart=this.input.selectionEnd=s})},record(){this.$nextTick(()=>{this.previousExpr[++this.exprIndex]={expr:this.input.value,cursor:this.cursorPosition}});const e=this.previousExpr.length;this.previousExpr=this.previousExpr.slice(Math.max(this.exprIndex-15,0),this.exprIndex+1),e>2*15&&(this.exprIndex=15)},addResult(s){if(this.result===null)return;const e=this.memories[s];if(Array.isArray(e.value)){Array.isArray(this.result)?e.value=e.value.concat(this.result):e.value=[...e.value,this.result];return}Array.isArray(this.result)||(e.value+=this.result)},subResult(s){if(this.result===null)return;const e=this.memories[s];if(Array.isArray(e.value)){Array.isArray(this.result)?e.value=e.value.filter(o=>!this.result.includes(o)):e.value=e.value.filter(o=>o!==this.result);return}Array.isArray(this.result)||typeof e.value=="string"||typeof this.result=="string"||(e.value-=this.result)},insertAtCursor(s){const e=this.cursorPosition;this.expr=this.expr.slice(0,this.cursorPosition)+s+this.expr.slice(this.cursorPosition),this.input.focus(),this.setCursor(e+s.length)},changeResultSize(){const s=this.$refs.result,e=this.$refs.output.clientWidth-40;s.clientWidth>e?this.resultScale=e/s.clientWidth:this.resultScale=1},changeChoice(s,e){const o=s.target,l=500;o.style.animation="change-choice "+l/1e3+"s",setTimeout(()=>{const u=this.choices[e];u.selectedIndex=(u.selectedIndex+1)%u.options.length,u.selected=u.options[u.selectedIndex]},l/2),setTimeout(()=>{o.style.animation=""},l)},store(s){this.result!=null&&s.unshift({value:this.result,mousein:!1,symbol:Symbol()})},toggleMemory(){if(this.showMemory)return;this.showMemory=!0;let s=!1;const e=()=>{s||(s=!0,this.showMemory=!1,window.removeEventListener("resize",e),window.removeEventListener("click",o),this.$refs.memoryHandle.removeEventListener("click",e))};window.addEventListener("resize",e);const o=l=>{!this.$refs.memoryHistory.contains(l.target)&&!this.$refs.memoryKeys.contains(l.target)&&e()};window.addEventListener("click",o),this.$refs.memoryHandle.addEventListener("click",e)},pressKey(s,e){this.input.focus(),this.runKey(s,e)},runKey(s,e){if(s==="DEG")this.changeChoice(e,0);else if(s==="F-E")this.on[0]=!this.on[0];else if(s==="MC")this.memories=[];else if(s==="MR")this.expr=this.memories[0].value.toString();else if(s==="M+")this.insertAtCursor("+"+this.memories[0].value);else if(s==="M-")this.insertAtCursor("-"+this.memories[0].value);else if(s==="MS")this.store(this.memories);else if(s==="M")this.toggleMemory();else if(s==="←")this.cursorPosition=Math.max(this.cursorPosition-1,0);else if(s==="→")this.cursorPosition=Math.min(this.cursorPosition+1,this.expr.length);else if(s==="C")this.expr="";else if(s==="⌫"){this.expr[this.cursorPosition-1]==="("&&this.expr[this.cursorPosition]===")"?this.expr=this.expr.slice(0,this.cursorPosition-1)+this.expr.slice(this.cursorPosition+1):this.expr=this.expr.slice(0,this.cursorPosition-1)+this.expr.slice(this.cursorPosition);const o=this.cursorPosition-1;this.setCursor(o)}else if(s==="( )"){this.insertAtCursor("()");const o=this.cursorPosition;this.setCursor(o+1)}else s==="Un"?(this.exprIndex=Math.max(0,this.exprIndex-1),this.expr=this.previousExpr[this.exprIndex].expr,this.setCursor(this.previousExpr[this.exprIndex].cursor)):s==="Re"?(this.exprIndex=Math.min(this.previousExpr.length-1,this.exprIndex+1),this.expr=this.previousExpr[this.exprIndex].expr,this.setCursor(this.previousExpr[this.exprIndex].cursor)):s==="="?this.store(this.history):this.insertAtCursor(s);(["C","⌫","( )","/","*","-","+","."].includes(s)||!Number.isNaN(+s))&&this.record()}}}),C=s=>(S("data-v-da75c151"),s=s(),w(),s),x={class:"view"},I={class:"output",ref:"output"},A={class:"input"},P={class:"options"},R={class:"memory-keys",ref:"memoryKeys"},F=C(()=>i("div",{class:"other-keys"},[i("div",{class:"other-key key"},"三角函数"),i("div",{class:"other-key key"},"其他函数")],-1)),D={class:"input-keys"},T=C(()=>i("div",{class:"input-key key"},null,-1)),z={class:"title"},B=["onMouseenter","onMouseleave","onClick"],L={class:"value"},H=["onClick"],G=["onMouseenter","onMouseleave","onClick"],N={class:"value"},U=["onClick"],O=["onClick"],V=["onClick"];function W(s,e,o,l,u,j){return y(),a("div",x,[i("div",{class:"control",style:r({filter:s.showMemory?"brightness(0.95)":"none"})},[i("div",I,[K(i("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>s.expr=t),class:"expr",ref:"expr",placeholder:" 键入表达式",onKeydowm:e[1]||(e[1]=(...t)=>s.record&&s.record(...t))},null,544),[[E,s.expr]]),i("div",{class:"result",ref:"result",style:r({transform:`scale(${s.resultScale})`})},d(s.result===null?"...":typeof s.result=="number"&&s.on[0]?s.result.toExponential():s.result),5)],512),i("div",A,[i("div",P,[i("div",{class:"option-key key",onClick:e[2]||(e[2]=t=>s.pressKey("DEG",t))},d(s.choices[0].selected),1),i("div",{class:v(["option-key key switch",s.on[0]?"on":"off"]),onClick:e[3]||(e[3]=t=>s.pressKey("F-E"))},"F-E",2)]),i("div",R,[i("div",{class:"memory-key key",onClick:e[4]||(e[4]=t=>s.pressKey("MC"))},"MC"),i("div",{class:"memory-key key",onClick:e[5]||(e[5]=t=>s.pressKey("MR"))},"MR"),i("div",{class:"memory-key key",onClick:e[6]||(e[6]=t=>s.pressKey("M+"))},"M+"),i("div",{class:"memory-key key",onClick:e[7]||(e[7]=t=>s.pressKey("M-"))},"M-"),i("div",{class:"memory-key key",onClick:e[8]||(e[8]=t=>s.pressKey("MS"))},"MS"),i("div",{class:"memory-key key",ref:"memoryHandle",onClick:e[9]||(e[9]=t=>s.pressKey("M"))},"M",512)],512),F,i("div",D,[i("div",{class:"input-key key",onClick:e[10]||(e[10]=t=>s.pressKey("←"))},"←"),i("div",{class:"input-key key",onClick:e[11]||(e[11]=t=>s.pressKey("→"))},"→"),i("div",{class:"input-key key",onClick:e[12]||(e[12]=t=>s.pressKey("C"))},"C"),i("div",{class:"input-key key",onClick:e[13]||(e[13]=t=>s.pressKey("⌫"))},"⌫"),i("div",{class:"input-key key",onClick:e[14]||(e[14]=t=>s.pressKey("( )"))},"( )"),i("div",{class:"input-key key",onClick:e[15]||(e[15]=t=>s.pressKey("Un"))},"Un"),i("div",{class:"input-key key",onClick:e[16]||(e[16]=t=>s.pressKey("Re"))},"Re"),i("div",{class:"input-key key",onClick:e[17]||(e[17]=t=>s.pressKey("/"))},"/"),i("div",{class:"input-key key",onClick:e[18]||(e[18]=t=>s.pressKey("7"))},"7"),i("div",{class:"input-key key",onClick:e[19]||(e[19]=t=>s.pressKey("8"))},"8"),i("div",{class:"input-key key",onClick:e[20]||(e[20]=t=>s.pressKey("9"))},"9"),i("div",{class:"input-key key",onClick:e[21]||(e[21]=t=>s.pressKey("*"))},"*"),i("div",{class:"input-key key",onClick:e[22]||(e[22]=t=>s.pressKey("4"))},"4"),i("div",{class:"input-key key",onClick:e[23]||(e[23]=t=>s.pressKey("5"))},"5"),i("div",{class:"input-key key",onClick:e[24]||(e[24]=t=>s.pressKey("6"))},"6"),i("div",{class:"input-key key",onClick:e[25]||(e[25]=t=>s.pressKey("-"))},"-"),i("div",{class:"input-key key",onClick:e[26]||(e[26]=t=>s.pressKey("1"))},"1"),i("div",{class:"input-key key",onClick:e[27]||(e[27]=t=>s.pressKey("2"))},"2"),i("div",{class:"input-key key",onClick:e[28]||(e[28]=t=>s.pressKey("3"))},"3"),i("div",{class:"input-key key",onClick:e[29]||(e[29]=t=>s.pressKey("+"))},"+"),T,i("div",{class:"input-key key",onClick:e[30]||(e[30]=t=>s.pressKey("0"))},"0"),i("div",{class:"input-key key",onClick:e[31]||(e[31]=t=>s.pressKey("."))},"."),i("div",{class:"input-key key",style:{"background-color":"#1d62e2",color:"#fff"},onClick:e[32]||(e[32]=t=>s.pressKey("="))},"=")])])],4),i("div",{class:"memory-history",ref:"memoryHistory",style:r({transform:`translateY(${s.showMemory?"-100%":0})`})},[i("div",z,[i("div",{class:v(["m-choice switch",s.on[1]?"on":"off"]),onClick:e[33]||(e[33]=t=>{s.on[1]=!0,s.on[2]=!1})},"历史",2),i("div",{class:v(["m-choice switch",s.on[2]?"on":"off"]),onClick:e[34]||(e[34]=t=>{s.on[1]=!1,s.on[2]=!0})},"记忆",2)]),i("div",{class:"container",style:r({transform:s.on[2]?"translateX(-50%)":"none"})},[k(f,{name:"list",tag:"div",class:"list",style:r([{left:"0"},{opacity:s.on[2]?0:1}])},{default:h(()=>[(y(!0),a(m,null,c(s.history,(t,p)=>(y(),a("div",{class:"item",key:t.symbol,onMouseenter:n=>t.mousein=!0,onMouseleave:n=>t.mousein=!1,onClick:n=>s.expr=t.value.toString()},[i("div",L,d(t.value),1),i("div",{class:"keys",style:r({opacity:t.mousein?1:0})},[i("div",{class:"key",style:r({backgroundColor:t.mousein?"#f8f8f8":"#fff"}),onClick:n=>s.history.splice(p,1)},"HC",12,H)],4)],40,B))),128))]),_:1},8,["style"]),k(f,{name:"list",tag:"div",class:"list",style:r([{left:"50%"},{opacity:s.on[2]?1:0}])},{default:h(()=>[(y(!0),a(m,null,c(s.memories,(t,p)=>(y(),a("div",{class:"item",key:t.symbol,onMouseenter:n=>t.mousein=!0,onMouseleave:n=>t.mousein=!1,onClick:n=>s.expr=t.value.toString()},[i("div",N,d(t.value),1),i("div",{class:"keys",style:r({opacity:t.mousein?1:0})},[i("div",{class:"key",style:r({backgroundColor:t.mousein?"#f8f8f8":"#fff"}),onClick:n=>s.memories.splice(p,1)},"MC",12,U),i("div",{class:"key",style:r({backgroundColor:t.mousein?"#f8f8f8":"#fff"}),onClick:n=>s.addResult(p)}," M+",12,O),i("div",{class:"key",style:r({backgroundColor:t.mousein?"#f8f8f8":"#fff"}),onClick:n=>s.subResult(p)}," M-",12,V)],4)],40,G))),128))]),_:1},8,["style"])],4)],4)])}const q=g(b,[["render",W],["__scopeId","data-v-da75c151"]]);export{q as default};
